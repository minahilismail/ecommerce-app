<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="">
      <!-- Page Header -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <div class="row align-items-center">
            <div class="col">
              <h4 class="mb-0">
                {{ action }}
              </h4>
            </div>
            <div class="col-auto"></div>
          </div>
        </div>
      </div>

      <!-- Add Product Form -->
      <div class="card shadow-sm">
        <div class="card-body p-4">
          <form
            #productForm="ngForm"
            (ngSubmit)="onSubmit(productForm.value)"
            novalidate
          >
            <div class="row">
              <!-- Product Title -->
              <div class="col-12 mb-3">
                <label for="title" class="form-label">
                  Product Title <span class="text-danger">*</span>
                </label>
                <input
                  type="text"
                  class="form-control"
                  id="title"
                  name="title"
                  placeholder="Enter product title"
                  required
                  #title="ngModel"
                  [ngModel]="product?.title || ''"
                  [class.is-invalid]="title.invalid && title.touched"
                  [class.is-valid]="title.valid && title.touched"
                />
                <div
                  class="invalid-feedback"
                  *ngIf="title.invalid && title.touched"
                >
                  Product title is required
                </div>
              </div>

              <!-- Product Price -->
              <div class="col-md-6 mb-3">
                <label for="price" class="form-label">
                  Price ($) <span class="text-danger">*</span>
                </label>
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  <input
                    type="number"
                    class="form-control"
                    id="price"
                    name="price"
                    placeholder="0.00"
                    min="0"
                    step="0.01"
                    required
                    #price="ngModel"
                    [ngModel]="product?.price || ''"
                    [class.is-invalid]="price.invalid && price.touched"
                    [class.is-valid]="price.valid && price.touched"
                  />
                  <div
                    class="invalid-feedback"
                    *ngIf="price.invalid && price.touched"
                  >
                    Price is required and must be greater than 0
                  </div>
                </div>
              </div>

              <!-- Product Category -->
              <div class="col-md-6 mb-3">
                <label for="category" class="form-label">
                  Category <span class="text-danger">*</span>
                </label>
                <select
                  class="form-select"
                  id="categoryId"
                  name="categoryId"
                  required
                  #categoryId="ngModel"
                  [ngModel]="product?.categoryId || ''"
                  [class.is-invalid]="categoryId.invalid && categoryId.touched"
                  [class.is-valid]="categoryId.valid && categoryId.touched"
                >
                  <option value="">Select Category</option>
                  <option
                    *ngFor="let category of categories"
                    [value]="category.id"
                  >
                    {{ category.name }}
                  </option>
                </select>
                <div
                  class="invalid-feedback"
                  *ngIf="categoryId.invalid && categoryId.touched"
                >
                  Please select a category
                </div>
              </div>

              <!-- Product Description -->
              <div class="col-12 mb-3">
                <label for="description" class="form-label">
                  Description <span class="text-danger">*</span>
                </label>
                <textarea
                  class="form-control"
                  id="description"
                  name="description"
                  rows="4"
                  placeholder="Enter product description"
                  required
                  #description="ngModel"
                  [ngModel]="product?.description || ''"
                  [class.is-invalid]="
                    description.invalid && description.touched
                  "
                  [class.is-valid]="description.valid && description.touched"
                ></textarea>
                <div
                  class="invalid-feedback"
                  *ngIf="description.invalid && description.touched"
                >
                  Product description is required
                </div>
                <div class="form-text">
                  <span class="text-muted"
                    >{{ description.value?.length || 0 }}/500 characters</span
                  >
                </div>
              </div>

              <!-- Product Image Upload -->
              <div class="col-12 mb-3" *ngIf="shouldShowImageUpload">
                <label for="image" class="form-label"> Product Image </label>
                <input
                  type="file"
                  class="form-control"
                  id="image"
                  name="image"
                  #image="ngModel"
                  [ngModel]="product?.image || ''"
                  [class.is-invalid]="
                    !selectedImage && !product?.image && image.touched
                  "
                  [class.is-valid]="selectedImage || product?.image"
                  accept="image/*"
                  (change)="onImageSelected($event)"
                  [required]="
                    action !== 'Update Product' || product?.image === ''
                  "
                />
                <div
                  class="invalid-feedback"
                  *ngIf="
                    !selectedImage && !product?.image && productForm.submitted
                  "
                >
                  Please upload a product image
                </div>
                <div class="form-text">
                  Supported formats: JPG, PNG. Max size: 5MB
                </div>
              </div>

              <!-- Image Preview -->
              <div
                class="col-12 mb-3 d-flex justify-content-center"
                *ngIf="imagePreview"
              >
                <div
                  class="image-preview-container position-relative d-inline-block"
                >
                  <img
                    [src]="imagePreview"
                    class="img-thumbnail"
                    alt="Product preview"
                    style="
                      max-width: 200px;
                      max-height: 200px;
                      object-fit: contain;
                    "
                  />
                  <button
                    type="button"
                    class="btn btn-lg position-absolute top-0 end-0"
                    style="transform: translate(50%, -50%)"
                    (click)="removeImage()"
                    title="Remove image"
                  >
                    Ã—
                  </button>
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="row mt-4">
              <div class="col-12">
                <div class="d-flex gap-3 justify-content-end">
                  <!-- Main Submit Button -->
                  <button
                    type="submit"
                    class="btn btn-primary"
                    [disabled]="
                      productForm.invalid || !imagePreview || isLoading
                    "
                  >
                    <span
                      class="spinner-border spinner-border-sm me-2"
                      role="status"
                      aria-hidden="true"
                      *ngIf="isLoading"
                    ></span>

                    {{ action === "Update Product" ? "Update" : "Add" }}
                  </button>
                </div>
              </div>
            </div>

            <!-- Form Status Info -->
            <div
              class="row mt-3"
              *ngIf="productForm.submitted && productForm.invalid"
            >
              <div class="col-12">
                <div class="alert alert-danger" role="alert">
                  <i class="bi bi-exclamation-triangle"></i>
                  Please fill in all required fields correctly before
                  submitting.
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
